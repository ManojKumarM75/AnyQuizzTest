<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz App</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
</head>
<body>
    <div id="loginContainer">  <!--- "YOUR_GOOGLE_CLIENT_ID" below -->
        <div id="g_id_onload"
             data-client_id= ""
             data-callback="handleCredentialResponse">
        </div>
        <div class="g_id_signin" data-type="standard"></div>
    </div>
    <div id="quizContainer" style="display: none;">
        <h1>Quiz</h1>
        <div id="questions"></div>
        <button onclick="submitQuiz()">Submit</button>
    </div>

    <script>
        const DEPLOYMENT_ID = 'YOUR_DEPLOYMENT_ID';
        const API_URL = `https://script.google.com/macros/s/${DEPLOYMENT_ID}/exec`;
        
        let userEmail = '';
        let quizQuestions = [];

        function handleCredentialResponse(response) {
            const responsePayload = parseJwt(response.credential);
            userEmail = responsePayload.email;
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'block';
            fetchQuizQuestions();
        }

        function parseJwt(token) {
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        function fetchQuizQuestions() {
            fetch(API_URL, {
                method: 'GET',
                mode: 'cors'
            })
            .then(response => response.json())
            .then(data => {
                quizQuestions = data;
                displayQuestions();
            })
            .catch(error => console.error('Error:', error));
        }

        function displayQuestions() {
            const questionsContainer = document.getElementById('questions');
            quizQuestions.forEach((question, index) => {
                const questionElement = document.createElement('div');
                questionElement.innerHTML = `
                    <h3>${index + 1}. ${question.question}</h3>
                    <input type="radio" name="q${index}" value="A"> ${question.optionA}<br>
                    <input type="radio" name="q${index}" value="B"> ${question.optionB}<br>
                    <input type="radio" name="q${index}" value="C"> ${question.optionC}<br>
                    <input type="radio" name="q${index}" value="D"> ${question.optionD}<br>
                `;
                questionsContainer.appendChild(questionElement);
            });
        }

        function submitQuiz() {
            quizQuestions.forEach((question, index) => {
                const selectedAnswer = document.querySelector(`input[name="q${index}"]:checked`);
                if (selectedAnswer) {
                    logAnswer(question.id, selectedAnswer.value);
                }
            });
            alert('Quiz submitted successfully!');
        }

        function logAnswer(questionId, userAnswer) {
            fetch(API_URL, {
                method: 'POST',
                mode: 'cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'logAnswer',
                    email: userEmail,
                    questionId: questionId,
                    answer: userAnswer
                })
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>
